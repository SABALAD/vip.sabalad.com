(function(a,d){"function"===typeof define&&define.amd?define("jquery mooButton mooPhrase mooGlobal mooAlert mooFileUploader mooValidate typeahead bloodhound tagsinput".split(" "),d):"object"===typeof exports?module.exports=d(require("jquery")):a.mooCredit=d()})(this,function(a,d,f,r,g,t,u,v,w,x){var h=function(){var b=new Bloodhound({datumTokenizer:function(c){return Bloodhound.tokenizers.whitespace(c.name)},queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:{url:mooConfig.url.base+"/credits/get_member.json",
cache:!1,filter:function(c){return a.map(c.data,function(e){return e})}},identify:function(c){return c.id}});b.initialize();a("#friendSuggestion").tagsinput({freeInput:!1,itemValue:"id",itemText:"name",typeaheadjs:{name:"friends_friendSuggestion",displayKey:"name",highlight:!0,limit:10,source:b.ttAdapter(),templates:{notFound:'<div class="empty-message"> unable to find any member </div>',suggestion:function(c){return""!=a("#userTagging").val()&&-1!=a("#friendSuggestion").val().split(",").indexOf(c.id)?
'<div class="empty-message" style="display:none">unable to find any member</div>':['<div class="suggestion-item">','<img alt src="'+c.avatar+'"/>','<span class="text">'+c.name+"</span>","</div>"].join("")}}}});a("#sendButtonCredit").click(function(){d.disableButton("sendButtonCredit");a("#sendButtonCredit").spin("small");a.post(mooConfig.url.base+"/credits/ajax_doSend",jQuery("#sendCredits").serialize(),function(c){d.enableButton("sendButtonCredit");a("#sendButtonCredit").spin(!1);c=a.parseJSON(c);
1==c.result?(a("#friend").val(""),a("#credit").val(""),a(".error-message").hide(),a(".alert-success").show(),a(".alert-success").html(c.message)):(a(".alert-success").hide(),a(".error-message").show(),a(".error-message").html(c.message))});return!1})},k=function(){a("#friends").tokenInput(mooConfig.url.base+"/friends/do_get_json",{preventDuplicates:!0,hintText:f.__("Enter a friend's name"),noResultsText:f.__("No results"),tokenLimit:10,resultsFormatter:function(b){return"<li>"+b.avatar+b.name+"</li>"}});
a("#sendButtonCredit").click(function(){d.disableButton("sendButtonCredit");a("#sendButtonCredit").spin("small");a.post(mooConfig.url.base+"/credits/ajax_doSend",jQuery("#sendCredits").serialize(),function(b){d.enableButton("sendButtonCredit");a("#sendButtonCredit").spin(!1);b=a.parseJSON(b);1==b.result?(a("#friend").val(""),a("#credit").val(""),a(".error-message").hide(),a(".alert-success").show(),a(".alert-success").html(b.message)):(a(".alert-success").hide(),a(".error-message").show(),a(".error-message").html(b.message))});
return!1})},l=function(){d.disableButton("createButton");a.post(mooConfig.url.base+"/credits/faq_save",a("#createForm").serialize(),function(b){d.enableButton("createButton");b=a.parseJSON(b);1==b.result?location.reload():(a(".error-message").show(),a(".error-message").html("<strong>Error! </strong>"+b.message))});return!1},m=function(){a("#createFormWithDraw").validate({errorClass:"error-message",errorElement:"div"});a("#amount").on("keyup",function(){var b=a(this).val()*formula_credit/formula_money;
a("#wd_money").text(b)});a.validator.addMethod("compare",function(b,c,e){return parseInt(b)>=parseInt(minimum_withdrawal_amount)&&parseInt(b)<=parseInt(maximum_withdrawal_amount)?!0:!1},f.__("validate_between"));a(document).off("click","#btnWithDraw");a(document).on("click","#btnWithDraw",function(){a("#amount").rules("add",{required:!0,number:!0,compare:a("#amount").val()});a("#payment").rules("add",{required:!0});a("#payment_info").rules("add",{required:function(b){return"none"==a("#li_payment_info").css("display")?
!1:!0}})});a("#payment").on("change",function(){""!=a("#payment option:selected").val()?a("#li_payment_info").show():a("#li_payment_info").hide()});a(document).off("click",".delete_withdraw_request");a(document).on("click",".delete_withdraw_request",function(){var b=a(this).attr("data-id");a("#themeModal .modal-content").load(url+"/credits/withdraw_delete/"+b);a("#themeModal").modal("show")})},n=function(){a("body").on("validateCredit",function(b,c){c.status=!1;c.message=f.__("credit_amount_not_enought")})},
p=function(b,c){a('input[type="submit"]').prop("disabled",!0);a("#buyCreditForm input").on("change",function(){a('input[type="submit"]').prop("disabled",!1);var e=a("input[name=sell_selected]:checked","#buyCreditForm").val().split("_");a(".sell_id").val(e[0]);a("#amount").val(e[1]);mooConfig.isApp?a("#return").val(b+"/"+e[0]+"?app_no_tab=1"):a("#return").val(b+"/"+e[0]);a("#notify_url").val(c+"/"+e[0])})},q=function(){a(".deleteRequestWithdraw").unbind("click");a(".deleteRequestWithdraw").click(function(b){b=
a(this).data();b=mooConfig.url.base+"/credit/credit_withdraw_payments/delete/"+b.id;g.confirm(f.__("are_you_sure_you_want_to_remove_this_entry"),b)});a(".btn-request-withdraw").unbind("click");a(".btn-request-withdraw").click(function(b){a(this).spin("small");a(this).attr("disabled","disabled");a.post(mooConfig.url.base+"/credit/credit_withdraw_payments/save_request_withdraw",a("#createForm").serialize(),function(c){c=a.parseJSON(c);1==c.result?window.location=mooConfig.isApp?mooConfig.url.base+"/credit/credit_withdraw_payments/success?app_no_tab=1":
mooConfig.url.base+"/credits/index/my_withdraw_requests":(a(".btn-request-withdraw").spin(!1),a(".btn-request-withdraw").removeAttr("disabled"),a(".error-message").show(),a(".error-message").html(c.message))})});a(".btn-request-withdraw-edit").unbind("click");a(".btn-request-withdraw-edit").click(function(b){a(this).spin("small");a(this).attr("disabled","disabled");a.post(mooConfig.url.base+"/credit/credit_withdraw_payments/save_request_withdraw_edit",a("#editForm").serialize(),function(c){c=a.parseJSON(c);
1==c.result?window.location=mooConfig.isApp?mooConfig.url.base+"/credit/credit_withdraw_payments/success?app_no_tab=1":mooConfig.url.base+"/credits/index/my_withdraw_requests":(a(".btn-request-withdraw-edit").spin(!1),a(".btn-request-withdraw-edit").removeAttr("disabled"),a(".error-message").show(),a(".error-message").html(c.message))})})};return{init:function(){n()},initCreditSendToMember:function(){h()},initCreditSendToFriend:function(){k()},creditFaqCreate:function(){l()},toggleField:function(){a(".opt_field").toggle()},
uploader:function(){uploader()},initWithDrawRequest:function(){m()},initBuyCreditPaypal:function(b,c){p(b,c)},initWithDrawal:function(){q()}}});